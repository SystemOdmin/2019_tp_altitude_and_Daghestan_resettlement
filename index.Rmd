---
title: 'Correlation of the altitude and number of speakers: case of Daghestan resettlement
  in XX century'
author: "L. Kazakevich, G. Moroz"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message = FALSE}
library(tidyverse)
theme_set(theme_bw())
options(scipen = 999)
```


## Get dataset

A dataset provided by [Samira Verhees 2019] could be found [here](https://github.com/sverhees/master_villages). 

[A repository](https://github.com/sverhees/master_villages) provided by Samira Verhees contains a dataset with all East Caucasian villages, their coordinates and the language spoken there. We merged it with dataset provided by Yury Koryakov which contains information about number of speakers in each village according to censuses in Russia and Soviet Union (add links...).

The result dataset has the following structure:

```{r, message=FALSE}
df <- read_csv("data/merged_all_census_and_samira.csv")
df %>% 
  filter(Republic == "Daghestan") %>% 
  distinct()->
  filtered_df

filtered_df %>% 
  write_csv("data/filtered_data.csv", na = "")

str(filtered_df)
```

* `koryakov_db_id` -- id info from Y. Koryakov database
* `eng_vil_name` -- English village name from Samira's db
* `rus_vil_name` -- Russian village name from Y. Koryakov's db
* `lang_1_K` -- lanuage according to Y. Koryakov
* `lang_2_K` -- dialect info according to Y. Koryakov
* `lang_1_S` -- language according to S. Verhess
* `lang_2_S` -- dialect info according to S. Verhess
* `same_languages` -- compare  lang_1_K and lang_1_S; need to be checked by someone; after this check we will come up with a new column with language information
* `name_1885` -- village name from 1885 census (from Y. Koryakov)
* `name_1895` -- village name from 1895 census (from Y. Koryakov)
* `name_1926` -- village name from 1926 census (from Y. Koryakov)
* `name_2010` -- village name from 2010 census (from Y. Koryakov)
* `census_1885` -- number of people from 1885 census (from Y. Koryakov)
* `census_1895` -- number of people from 1895 census (from Y. Koryakov)
* `census_1926` -- number of people from 1926 census (from Y. Koryakov)
* `census_2010` -- number of people from 2010 census (from Y. Koryakov)
* `Lat` -- latitude (from S. Verhess)
* `Lon` -- longitude (from S. Verhess)
* `Republic` --  info about Republic (from S. Verhees)
* `elevation` -- elevation data (collected by G. Moroz from Google)

## Nationality by language

```{r}
df <- read_csv("data/filtered_data.csv")
df %>% 
  filter(!str_detect(rus_vil_name, "Махачкала|Дербент|Буйнакск|Хасавюрт|Каспийск|Избербаш|Кизляр|Кизилюрт|Дагестанские Огни|Южно-Сухокумск")) %>%  # remove big cities
  select(koryakov_bd_id, rus_vil_name, lang_1_K, census_1885, census_1895, census_1926, census_2010) %>% 
  filter(!is.na(lang_1_K)) %>% 
  group_by(lang_1_K) %>% 
  summarise(c_1885 = sum(census_1885, na.rm = TRUE),
            c_1895 = sum(census_1895, na.rm = TRUE),
            c_1926 = sum(census_1926, na.rm = TRUE),
            c_2010 = sum(census_2010, na.rm = TRUE),
            sum = sum(c_1885, c_1895, c_1926, c_2010)) %>% 
  pivot_longer(names_to = "census", values_to = "n_people", c_1885:c_2010) %>% 
  mutate(lang_1_K = reorder(lang_1_K, sum)) %>% 
  ggplot(aes(lang_1_K, n_people, color = census, group = census))+
  geom_point()+
  geom_line()+
  coord_flip()+
  scale_y_log10()+
  labs(x = "", y = "n people (log scale)")
```

## Differences in census

## map

